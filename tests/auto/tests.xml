<?xml version="1.0" encoding="ISO-8859-1"?>
<testdefinition version="1.0">
  <suite name="libqtsparql-tests">
    <set name="qsparlq-unit" description="Unit tests of libqtsparql">
      <case name="qsparqlquery" description="qsparqlquery unit tests">
        <step expected_result="0">
	  /usr/lib/libqtsparql-tests/tst_qsparqlquery
        </step>
      </case>
      <case name="qsparqlbinding" description="qsparqlbinding unit tests">
        <step expected_result="0">
      /usr/lib/libqtsparql-tests/tst_qsparqlbinding
        </step>
      </case>
      <case name="qsparqlresultrow" description="qsparqlresultrow unit tests">
        <step expected_result="0">
      /usr/lib/libqtsparql-tests/tst_qsparqlresultrow
        </step>
      </case>
      <case name="qsparql" description="qsparql unit tests">
        <step expected_result="0">
	  /usr/lib/libqtsparql-tests/tst_qsparql
        </step>
      </case>
      <environments>
        <scratchbox>true</scratchbox>
        <hardware>true</hardware>
      </environments>
    </set>
    <set name="qsparql-tracker" description="Tests for tracker plugin of qsparql">
      <case name="tst_qsparql_tracker" description="Executing tst_qsparql_tracker">
        <step expected_result="0">
            su - user -c "/usr/lib/libqtsparql-tests/tst_qsparql_tracker"
        </step>
      </case>
      <environments>
        <scratchbox>true</scratchbox>
        <hardware>true</hardware>
      </environments>
      <get>
        <file>/home/user/.local/share/tracker/tracker-store.log</file>
      </get>
    </set>
    <set name="qsparql-tracker-direct" description="Tests for tracker direct access plugin of qsparql">
      <case name="tst_qsparql_tracker_direct" description="Executing tst_qsparql_tracker_direct" timeout="900">
        <step expected_result="0">
            su - user -c "/usr/lib/libqtsparql-tests/tst_qsparql_tracker_direct"
        </step>
      </case>
      <environments>
        <scratchbox>true</scratchbox>
        <hardware>true</hardware>
      </environments>
      <get>
        <file>/home/user/.local/share/tracker/tracker-store.log</file>
      </get>
    </set>
    <set name="qsparql-threading" description="Multithreading tests">
        <case name="test-tracker-queries" description="Tracker queries">
            <step expected_result="0">
                su - user -c "/usr/lib/libqtsparql-tests/tst_qsparql_threading concurrentTrackerQueries"
            </step>
        </case>
        <case name="test-tracker-direct-queries" description="Tracker direct queries">
            <step expected_result="0">
                su - user -c "/usr/lib/libqtsparql-tests/tst_qsparql_threading concurrentTrackerDirectQueries"
            </step>
        </case>
        <case name="test-tracker-direct-inserts" description="Tracker direct inserts" insignificant="true">
            <!-- this is marked as insigficant since it fails sporadically; this needs debugging! -->
            <step expected_result="0">
                su - user -c "/usr/lib/libqtsparql-tests/tst_qsparql_threading concurrentTrackerDirectInserts"
            </step>
        </case>
        <environments>
            <scratchbox>true</scratchbox>
            <hardware>true</hardware>
        </environments>
        <get>
            <file>/home/user/.local/share/tracker/tracker-store.log</file>
        </get>
    </set>
    <set name="qsparql-tracker-direct-sync" description="Tests for tracker direct access plugin of qsparql, sync mode">
        <case name="tst_qsparql_tracker_direct_sync" description="Executing tst_qsparql_tracker_direct_sync">
            <step expected_result="0">
                su - user -c "/usr/lib/libqtsparql-tests/tst_qsparql_tracker_direct_sync"
            </step>
        </case>
        <environments>
            <scratchbox>true</scratchbox>
            <hardware>true</hardware>
        </environments>
        <get>
            <file>/home/user/.local/share/tracker/tracker-store.log</file>
        </get>
    </set>
    <set name="qsparql-tracker-direct-crashes" description="Regression tests">
      <case name="tst_qsparql_tracker_direct_crashes" description="Regression test">
        <step expected_result="0">
            <!-- Note: the env vars should ensure that the direct connection opening fails -->
            su - user -c "XDG_CACHE_HOME=bogus TRACKER_SPARQL_BACKEND=direct /usr/lib/libqtsparql-tests/tst_qsparql_tracker_direct_crashes"
        </step>
      </case>
    </set>
  </suite>
</testdefinition>
